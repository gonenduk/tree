<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>jsTree Test</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/themes/default/style.min.css" />
</head>
<body style="display: none">

<div id="jstree">
</div>
<br>
<button id="btn">Info</button>
<p id="info"></p>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/jstree.min.js"></script>
<script>
    $(function () {
        $('body').show();

        $('#jstree').jstree({
            core: {
                multiple: false,
                data: function (node, cb) {
                    if (node.id == '#') {
                        cb.call(this, { id: '1', text: 'Root', parentUrl: 'root.com', parent: '#', state: { opened: false, selected: true }, children: true });
                    } else {
                        // Replace with HTTP call (osapi)
                        setTimeout(function () {
                            var subSites = [
                                { id: node.id + '-1', name: 'AAA', url: 'http://' + node.id + '-1.com', connected: false },
                                { id: node.id + '-2', name: 'BBB', url: 'http://' + node.id + '-2.com', connected: true }
                            ];
                            var status = 200;

                            // Build child list
                            var childList = [];
                            if (status == 200) {
                                subSites.forEach(function (site) {
                                    childList.push({ id: site.id, text: site.name, parentUrl: site.url, parent: node.id, children: true, state: { disabled: site.connected } });
                                });
                            }

                            cb.call(this, childList);
                        }, 333);
                    }
                }
            }
        });

        $('#btn').click(function () {
            var node = $('#jstree').jstree(true).get_selected('id')[0];
            $('#info').text(JSON.stringify({ id: node.id, name: node.text, url: node.original.parentUrl }));
        });
    });
</script>

</body>
</html>
